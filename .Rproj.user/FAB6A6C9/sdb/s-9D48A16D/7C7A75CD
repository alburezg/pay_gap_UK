{
    "collab_server" : "",
    "contents" : "# PREAMBLE ####\n\nif(!require(tidyverse)) {\n  install.packages(\"tidyverse\")\n  library(tidyverse)\n}\n\n# Get SIC codes ####\n\ncodes <- read.csv(\"data/SIC_codes.csv\", stringsAsFactors = F)\n\n# Source SIC codes from ONS\n# url <- \"http://resources.companieshouse.gov.uk/sic/\"\n# t <- htmltab(doc = url)\n# cats <- ifelse(!grepl(\"[0-9]+\", t$Code), t$Description, NA)\n# t$cat <- zoo::na.locf(cats)\n# codes <- t[grepl(\"[0-9]+\", t$Code),]\n# write.csv(t, \"SIC_codes.csv\")\n\n# Get dap data ####\n\ngap <- read.csv(\"data/gap_data.csv\", stringsAsFactors = F)\n\n# Assign sector data\n\ngap$sector <- codes$cat[match(gap$SicCodes,codes$Code)]\n\n# NOTE THAT ~ CODES WERE NOT MATCHED!\n\n# Plot ####\n\nsec_keep <- c(\"Manufacturing\",\n              \"Administrative and support service activities\",\n              \"Wholesale and retail trade; repair of motor vehicles and motorcycles\",\n              \"Professional, scientific and technical activities\",\n              \"Financial and insurance activities\"\n)\n\nxlabs2 <- c(\"Manufacturing\",\n            \"Admin & services\",\n            \"Wholesale and retail\", \n           \"Professional & scientific\",\n           \"Financial & insurance\"\n)\n\np <- gap %>%\n  dplyr::mutate(\n    # EmployerSize = factor(\n    #   ifelse(EmployerSize == \"Not Provided\", NA, EmployerSize),\n    #   levels = c(\"Less than 250\",\"250 to 499\",\"500 to 999\",\"1000 to 4999\",  \"5000 to 19,999\", \"20,000 or more\")\n    # )\n    sector = factor(sector, levels = sec_keep)\n      ) %>%\n  dplyr::filter(sector %in% sec_keep) %>%\n  dplyr::rename(var = sector) %>%\n      dplyr::group_by(var) %>%\n      dplyr::summarise(\n        `Hourly rate` = mean(DiffMeanHourlyPercent),\n        # median = median(DiffMeanHourlyPercent),\n        `Bonus payment` = mean(DiffMeanBonusPercent)\n        # median_bonus = median(DiffMedianBonusPercent)\n        ) %>%\n  reshape2::melt(id=\"var\") %>%\n  ggplot(aes(x = var, y = value, fill = var)) +\n  geom_col(position = \"dodge\") +\n  scale_fill_discrete(\"Sector\",labels = xlabs2) +\n  scale_y_continuous(\"% by which women are paid less than men\") +\n  scale_x_discrete(\"\") +\n  facet_grid(~variable) +\n  # theme_bw() +\n  labs(title = \"Gender pay gap in the UK (2017-18)\",\n       caption = \"Source: @d_alburez with data from https://gender-pay-gap.service.gov.uk/\") +\n  theme_bw() +\n  theme(axis.text.x=element_blank(),\n        axis.ticks.x=element_blank(),\n        text = element_text(size=14)) \n  ",
    "created" : 1523119209812.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3847031490",
    "id" : "7C7A75CD",
    "lastKnownWriteTime" : 1523119287,
    "last_content_update" : 1523119287568,
    "path" : "C:/Users/USUARIO/Google Drive/GitHub/pay_gap_UK/gap.r",
    "project_path" : "gap.r",
    "properties" : {
        "docOutlineVisible" : "1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}